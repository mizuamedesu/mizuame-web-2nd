---
import { type CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';
import { render } from 'astro:content';
import Comments from "../../components/Comments.astro";

export async function getStaticPaths() {
	const posts = await getCollection('blog');

	// 日本語記事のみをフィルタリング（ja/で始まるもの）
	const jaPosts = posts.filter((post) => post.id.startsWith('ja/'));

	// 英語版の存在を確認するためのセット
	const enSlugs = new Set(
		posts.filter((post) => post.id.startsWith('en/'))
			.map((post) => post.id.replace('en/', ''))
	);

	return jaPosts.map((post) => {
		const slug = post.id.replace('ja/', '');
		const hasTranslation = enSlugs.has(slug);
		return {
			params: { slug },
			props: { post, hasTranslation },
		};
	});
}

interface Props {
	post: CollectionEntry<'blog'>;
	hasTranslation: boolean;
}

const { post, hasTranslation } = Astro.props;
const { Content } = await render(post);
const articleSlug = post.id.replace('ja/', '');
---

<BlogPost {...post.data} slug={articleSlug} lang="ja" hasTranslation={hasTranslation}>
	<Content />
	<Comments lang="ja" />
</BlogPost>
---
title: 'Running UE5 Dedicated Server in Docker with Reverse Proxy'
description: 'Docker it up'
pubDate: '2024-12-10'
heroImage: '/blog-card/Card_2024-12-10.png'
---

[This article is Day 10 of Unreal Engine (UE) Advent Calendar 2024.](https://qiita.com/advent-calendar/2024/ue)

## Introduction

This article only minimally covers the actual server processing, Linux export, and building the engine from source. These are assumed prerequisites.
However, UE5.4 and 5.5 have a network checksum mismatch error that prevents dedicated servers from working, so we're using UE5.3.2. See [this article for details](https://forums.unrealengine.com/t/unreal-5-4-problem-with-a-packaged-game-server-spawns-the-character-and-client-disconnecting-with-failed-to-load-package-error/1841350).
It can apparently be fixed with effort.

## Environment

client: Windows 11
server: Ubuntu Server 24.04 LTS (on Proxmox VE)

[UE5.3.2](https://github.com/EpicGames/UnrealEngine/tree/5.3)
Using ThirdPerson Template

## BP Setup

![](/blog-content-img/2024-12-10/image-1-11ed9efd0f1c.png)

In BP_ThirdPersonCharacter, show UI only in local environment.

![](/blog-content-img/2024-12-10/image-2-af3ca9c10337.png)

![](/blog-content-img/2024-12-10/image-3-9acb5ed81f0e.png)

Create minimal UI.

## Export

![](/blog-content-img/2024-12-10/image-4-5b51cc8ce9ec.png)

Select your level as the server default map.
Then export for Linux server and Windows client.

## Creating the Dockerfile

Install Docker Desktop first, then:

```dockerfile
FROM ubuntu:22.04

RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    python3 \
    python3-pip \
    curl \
    wget \
    libssl-dev \
    libffi-dev \
    libsqlite3-dev \
    zlib1g-dev \
    xdg-user-dirs \
    && rm -rf /var/lib/apt/lists/*

RUN useradd -m gameuser
WORKDIR /game

COPY Engine/ /game/Engine/
COPY QiitaDemo/ /game/QiitaDemo/
COPY QiitaDemo.sh /game/
RUN mkdir -p /game/QiitaDemo && \
    touch /game/QiitaDemo/QiitaDemo.uproject && \
    chown -R gameuser:gameuser /game && \
    chmod +x /game/QiitaDemo.sh

USER gameuser
EXPOSE 7777/udp
CMD ["./QiitaDemo.sh"]
```

(This worked after multiple error fixes based on internet info, no guarantee it's correct.)

![](/blog-content-img/2024-12-10/image-5-516ad778cb92.png)

Run in the dockerfile directory:
```bash
docker build -t ue5-server .
```

![](/blog-content-img/2024-12-10/image-6-61102ffbdc1f.png)

Takes about 10 minutes.

When done:
```bash
docker run -p 7777:7777/udp ue5-server
```

![](/blog-content-img/2024-12-10/image-7-b3301bfbd3d7.png)

## Connection

Confirmed local connection.

## Deploying to Server

Export the image:
```bash
docker save ue5-server > ue5-server.tar
```

SSH to your server (using Ubuntu 24.04).
Transfer the image via scp or file server.

```bash
docker load < ue5-server.tar
```

Then:
```bash
docker run -p 7777:7777/udp ue5-server
```

## UDP Reverse Proxy

Game servers typically use UDP, but few services proxy this. [Cloudflare Tunnel](https://www.cloudflare.com/products/tunnel/) handles TCP but not UDP.
You could use a VPS with [WireGuard](https://www.wireguard.com/) VPN and port forwarding.
I found [Localtonet](https://localtonet.com/) which handles UDP. Free tier allows 1GB monthly transfer.

## Localtonet Setup

![](/blog-content-img/2024-12-10/image-8-8163c5b0f8b4.png)

Select UDP, Tokyo server, port 7777.

```bash
wget https://localtonet.com/download/localtonet-linux-x64.zip
sudo apt install unzip
unzip localtonet-linux-x64.zip
chmod 777 localtonet
./localtonet
```

Enter your token from My Tokens on the web.

![](/blog-content-img/2024-12-10/image-9-00846a3d591d.png)

Copy the URL and port from the tunnel creation screen.

![](/blog-content-img/2024-12-10/image-10-b8646f094b5e.png)

## Connection Confirmed

Connection verified over the internet.

## Downloads

Not sure if there's demand, but here are the container image and client. Should work on Windows 10/11 + Docker Desktop.

[Windows Client](https://main-static.mizuame.works/blog/Windows.zip)
[Docker Image](https://main-static.mizuame.works/blog/ue5-server.tar)

## Summary
We confirmed connecting to a dedicated server over the internet. In production, you'd likely run on k8s, but on-premises servers offer significant cost savings.
